<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - Shopl B2B SaaS</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { color: #007bff; margin: 0; }
        .header .breadcrumb { color: #6c757d; font-size: 14px; margin-top: 5px; }
        .user-info { background: #e9f4ff; padding: 15px; border-radius: 6px; border-left: 4px solid #007bff; margin-bottom: 20px; }
        .user-info .label { font-weight: bold; color: #495057; }
        .user-info .value { color: #6c757d; font-family: monospace; }
        .navigation { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .nav-card { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; transition: all 0.3s ease; cursor: pointer; }
        .nav-card:hover { background: #e9ecef; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .nav-card .icon { font-size: 48px; margin-bottom: 15px; }
        .nav-card h3 { margin: 0 0 10px 0; color: #495057; }
        .nav-card p { margin: 0; color: #6c757d; font-size: 14px; }
        .stats-section { margin-top: 30px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 20px; border-radius: 8px; text-align: center; }
        .stat-card .number { font-size: 32px; font-weight: bold; margin-bottom: 5px; }
        .stat-card .label { font-size: 14px; opacity: 0.9; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 14px; transition: all 0.3s ease; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-secondary:hover { background-color: #545b62; }
        .quick-actions { margin-top: 20px; }
        .quick-actions .btn { margin-right: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ê´€ë¦¬ì ì¸ì¦ ëŒ€ì‹œë³´ë“œ</h1>
            <div class="breadcrumb">Shopl B2B SaaS > ê´€ë¦¬ì > ì¸ì¦ ê´€ë¦¬</div>
        </div>

        <div class="user-info">
            <p><span class="label">ê´€ë¦¬ì:</span> <span class="value" th:text="${username}">admin</span></p>
            <p><span class="label">ê¶Œí•œ:</span> <span class="value" th:text="${userRole}">ADMIN</span></p>
            <p><span class="label">íšŒì‚¬ ID:</span> <span class="value" th:text="${companyId}">company-001</span></p>
        </div>

        <div class="navigation">
            <!-- SSO ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="nav-card" onclick="location.href='/admin/sso/configurations'">
                <div class="icon">ğŸ“‹</div>
                <h3>SSO ì„¤ì • ëª©ë¡</h3>
                <p>ë“±ë¡ëœ ëª¨ë“  SSO ì œê³µì ì„¤ì •ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="nav-card" onclick="location.href='/admin/sso/configurations/form'">
                <div class="icon">â•</div>
                <h3>ìƒˆ SSO ì„¤ì •</h3>
                <p>SAML, OIDC, OAuth2 ë“± ìƒˆë¡œìš´ SSO ì œê³µìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
            </div>

            <!-- ë¹ ë¥¸ SSO ì„¤ì • ì„¹ì…˜ -->
            <div class="nav-card" onclick="quickAddSAML()">
                <div class="icon">ğŸ”</div>
                <h3>SAML ë¹ ë¥¸ ì„¤ì •</h3>
                <p>SAML 2.0 ì œê³µìë¥¼ ë¹ ë¥´ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="nav-card" onclick="quickAddOIDC()">
                <div class="icon">ğŸ†”</div>
                <h3>OIDC ë¹ ë¥¸ ì„¤ì •</h3>
                <p>OpenID Connect ì œê³µìë¥¼ ë¹ ë¥´ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.</p>
            </div>

            <!-- í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ ì„¹ì…˜ -->
            <div class="nav-card" onclick="testAllConfigurations()">
                <div class="icon">ğŸ”§</div>
                <h3>ì „ì²´ SSO í…ŒìŠ¤íŠ¸</h3>
                <p>ëª¨ë“  í™œì„±í™”ëœ SSO ì„¤ì •ì˜ ì—°ê²° ìƒíƒœë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="nav-card" onclick="showSSOUsageStats()">
                <div class="icon">ğŸ“Š</div>
                <h3>SSO ì‚¬ìš© í†µê³„</h3>
                <p>SSO ë¡œê·¸ì¸ ì„±ê³µë¥ , ì‚¬ìš©ëŸ‰ ë“± í†µê³„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            </div>

            <!-- ë³´ì•ˆ ë° ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="nav-card" onclick="showComingSoon()">
                <div class="icon">ğŸ›¡ï¸</div>
                <h3>ë³´ì•ˆ ê°ì‚¬ ë¡œê·¸</h3>
                <p>SSO ê´€ë ¨ ë³´ì•ˆ ì´ë²¤íŠ¸ì™€ ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="nav-card" onclick="showComingSoon()">
                <div class="icon">ğŸ“¥</div>
                <h3>ì„¤ì • ê°€ì ¸ì˜¤ê¸°</h3>
                <p>ë‹¤ë¥¸ ì‹œìŠ¤í…œì˜ SSO ì„¤ì •ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>
            </div>

            <!-- ë„ì›€ë§ ì„¹ì…˜ -->
            <div class="nav-card" onclick="showSSOGuide()">
                <div class="icon">ğŸ“–</div>
                <h3>SSO ì„¤ì • ê°€ì´ë“œ</h3>
                <p>ê° ì œê³µìë³„ ìƒì„¸í•œ ì„¤ì • ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>
            </div>
        </div>

        <div class="stats-section">
            <h3>ğŸ“ˆ SSO í˜„í™© (ê°œë°œ ì˜ˆì •)</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="number" id="totalConfigurations">0</div>
                    <div class="label">ì´ SSO ì„¤ì • ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="activeConfigurations">0</div>
                    <div class="label">í™œì„± SSO ì„¤ì •</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="todayLogins">0</div>
                    <div class="label">ì˜¤ëŠ˜ SSO ë¡œê·¸ì¸</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="successRate">0%</div>
                    <div class="label">ë¡œê·¸ì¸ ì„±ê³µë¥ </div>
                </div>
            </div>
        </div>

        <div class="quick-actions">
            <h3>âš¡ ë¹ ë¥¸ ì‹¤í–‰</h3>
            <a href="/dashboard" class="btn btn-secondary">ğŸ  ì¼ë°˜ ëŒ€ì‹œë³´ë“œ</a>
            <a href="/admin/sso/configurations" class="btn btn-primary">ğŸ“‹ SSO ì„¤ì • ëª©ë¡</a>
            <a href="/admin/sso/configurations/form" class="btn btn-primary">â• ìƒˆ SSO ì¶”ê°€</a>

            <h3 style="margin-top: 20px;">ğŸš€ ë¹ ë¥¸ ì„¤ì •</h3>
            <button onclick="quickAddSAML()" class="btn btn-success">ğŸ” SAML ë¹ ë¥¸ ì¶”ê°€</button>
            <button onclick="quickAddOIDC()" class="btn btn-success">ğŸ†” OIDC ë¹ ë¥¸ ì¶”ê°€</button>
            <button onclick="quickAddOAuth2()" class="btn btn-success">ğŸ”‘ OAuth2 ë¹ ë¥¸ ì¶”ê°€</button>

            <h3 style="margin-top: 20px;">ğŸ”§ ê´€ë¦¬ ë„êµ¬</h3>
            <button onclick="testAllConfigurations()" class="btn btn-warning">ğŸ”§ ì „ì²´ í…ŒìŠ¤íŠ¸</button>
            <button onclick="exportConfigurations()" class="btn btn-secondary">ğŸ“¤ ì„¤ì • ë‚´ë³´ë‚´ê¸°</button>
            <button onclick="importConfigurations()" class="btn btn-secondary">ğŸ“¥ ì„¤ì • ê°€ì ¸ì˜¤ê¸°</button>
        </div>
    </div>

    <script>
        function showComingSoon() {
            alert('ğŸš§ ê°œë°œ ì˜ˆì •ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤!');
        }

        // ë¹ ë¥¸ SSO ì„¤ì • í•¨ìˆ˜ë“¤
        function quickAddSAML() {
            const url = '/admin/sso/configurations/form?type=SAML&quick=true';
            window.location.href = url;
        }

        function quickAddOIDC() {
            const url = '/admin/sso/configurations/form?type=OIDC&quick=true';
            window.location.href = url;
        }

        function quickAddOAuth2() {
            const url = '/admin/sso/configurations/form?type=OAUTH2&quick=true';
            window.location.href = url;
        }

        // í…ŒìŠ¤íŠ¸ ë° ê´€ë¦¬ í•¨ìˆ˜ë“¤
        async function testAllConfigurations() {
            const confirmTest = confirm('ğŸ”§ ëª¨ë“  í™œì„±í™”ëœ SSO ì„¤ì •ì˜ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nì´ ì‘ì—…ì€ ëª‡ ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');

            if (!confirmTest) return;

            try {
                // í…ŒìŠ¤íŠ¸ ì§„í–‰ ì•Œë¦¼
                const progressModal = showProgressModal('SSO ì—°ê²° í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...', 0);

                // TODO: ì‹¤ì œ í…ŒìŠ¤íŠ¸ API í˜¸ì¶œ
                const testResults = await simulateAllSSOTest();

                hideProgressModal(progressModal);
                showTestResults(testResults);

            } catch (error) {
                alert('âŒ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function simulateAllSSOTest() {
            // ì‹œë®¬ë ˆì´ì…˜: 3ê°œì˜ SSO ì„¤ì • í…ŒìŠ¤íŠ¸
            const configs = ['Google Workspace', 'Microsoft Azure AD', 'Okta'];
            const results = [];

            for (let i = 0; i < configs.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 1000));
                results.push({
                    name: configs[i],
                    success: Math.random() > 0.3, // 70% ì„±ê³µë¥ 
                    responseTime: Math.floor(Math.random() * 500) + 100
                });
            }

            return results;
        }

        function showTestResults(results) {
            const successCount = results.filter(r => r.success).length;
            const totalCount = results.length;

            let message = `ğŸ”§ ì „ì²´ SSO í…ŒìŠ¤íŠ¸ ì™„ë£Œ\\n\\n`;
            message += `âœ… ì„±ê³µ: ${successCount}/${totalCount}\\n\\n`;

            results.forEach(result => {
                const status = result.success ? 'âœ…' : 'âŒ';
                message += `${status} ${result.name}: ${result.responseTime}ms\\n`;
            });

            alert(message);
        }

        function showProgressModal(message, progress) {
            // ê°„ë‹¨í•œ ì§„í–‰ë¥  í‘œì‹œ (ì‹¤ì œë¡œëŠ” ëª¨ë‹¬ êµ¬í˜„)
            console.log(`${message} ${progress}%`);
            return { message, progress };
        }

        function hideProgressModal(modal) {
            console.log('í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        // ì„¤ì • ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function exportConfigurations() {
            if (confirm('ğŸ“¤ í˜„ì¬ SSO ì„¤ì •ì„ JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // TODO: ì‹¤ì œ ë‚´ë³´ë‚´ê¸° API í˜¸ì¶œ
                alert('ğŸš§ ì„¤ì • ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ê°œë°œ ì˜ˆì •ì…ë‹ˆë‹¤.\\n\\ní–¥í›„ JSON, XML, CSV í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°ë¥¼ ì§€ì›í•  ì˜ˆì •ì…ë‹ˆë‹¤.');
            }
        }

        function importConfigurations() {
            if (confirm('ğŸ“¥ ë‹¤ë¥¸ ì‹œìŠ¤í…œì˜ SSO ì„¤ì •ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nê¸°ì¡´ ì„¤ì •ê³¼ ì¶©ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                // TODO: íŒŒì¼ ì—…ë¡œë“œ ì¸í„°í˜ì´ìŠ¤
                alert('ğŸš§ ì„¤ì • ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥ì€ ê°œë°œ ì˜ˆì •ì…ë‹ˆë‹¤.\\n\\nJSON, XML íŒŒì¼ì—ì„œ ì„¤ì •ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // í†µê³„ ë° ê°€ì´ë“œ í•¨ìˆ˜ë“¤
        function showSSOUsageStats() {
            // TODO: ì‹¤ì œ í†µê³„ í˜ì´ì§€ë¡œ ì´ë™
            alert('ğŸ“Š SSO ì‚¬ìš© í†µê³„\\n\\nâ€¢ ì˜¤ëŠ˜ ë¡œê·¸ì¸: 147íšŒ\\nâ€¢ ì´ë²ˆ ì£¼ ì„±ê³µë¥ : 94.2%\\nâ€¢ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ì œê³µì: Google Workspace\\n\\nğŸš§ ìƒì„¸ í†µê³„ í˜ì´ì§€ëŠ” ê°œë°œ ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        function showSSOGuide() {
            const guides = [
                'ğŸ“– SSO ì„¤ì • ê°€ì´ë“œ',
                '',
                'ğŸ” SAML 2.0 ì„¤ì • ê°€ì´ë“œ',
                'â€¢ ë©”íƒ€ë°ì´í„° URL í™•ì¸ ë°©ë²•',
                'â€¢ ì†ì„± ë§¤í•‘ ì„¤ì •',
                'â€¢ ì¸ì¦ì„œ ê´€ë¦¬',
                '',
                'ğŸ†” OIDC ì„¤ì • ê°€ì´ë“œ',
                'â€¢ Discovery URL ì„¤ì •',
                'â€¢ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ì„¤ì •',
                'â€¢ ìŠ¤ì½”í”„ ë° í´ë ˆì„ ë§¤í•‘',
                '',
                'ğŸ”‘ OAuth 2.0 ì„¤ì • ê°€ì´ë“œ',
                'â€¢ ì¸ì¦/í† í° ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •',
                'â€¢ ì‚¬ìš©ì ì •ë³´ API ì—°ë™',
                '',
                'ğŸš§ ìƒì„¸ ê°€ì´ë“œëŠ” ê°œë°œ ì˜ˆì •ì…ë‹ˆë‹¤.'
            ];

            alert(guides.join('\\n'));
        }

        // ê¶Œí•œ í™•ì¸
        async function checkPermission() {
            try {
                const token = localStorage.getItem("access_token");
                if (!token) {
                    window.location.href = '/dashboard?error=no_token';
                    return;
                }

                const response = await fetch('/admin/api/check-permission', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                const data = await response.json();
                if (!data.hasPermission) {
                    alert('âŒ SSO ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                    window.location.href = '/dashboard';
                }
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                window.location.href = '/dashboard?error=permission_check_failed';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¶Œí•œ í™•ì¸
        document.addEventListener('DOMContentLoaded', checkPermission);

        // í†µê³„ ë°ì´í„° ë¡œë“œ (í–¥í›„ êµ¬í˜„)
        async function loadStatistics() {
            // TODO: ì‹¤ì œ APIì—ì„œ í†µê³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            document.getElementById('totalConfigurations').textContent = '0';
            document.getElementById('activeConfigurations').textContent = '0';
            document.getElementById('todayLogins').textContent = '0';
            document.getElementById('successRate').textContent = '0%';
        }

        document.addEventListener('DOMContentLoaded', loadStatistics);
    </script>
</body>
</html>