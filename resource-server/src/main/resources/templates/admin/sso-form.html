<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SSO ì„¤ì • - Shopl B2B SaaS</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { color: #007bff; margin: 0; }
        .header .breadcrumb { color: #6c757d; font-size: 14px; margin-top: 5px; }
        .header .breadcrumb a { color: #007bff; text-decoration: none; }
        .header .breadcrumb a:hover { text-decoration: underline; }
        .user-info { background: #e9f4ff; padding: 15px; border-radius: 6px; border-left: 4px solid #007bff; margin-bottom: 20px; }
        .user-info .label { font-weight: bold; color: #495057; }
        .user-info .value { color: #6c757d; font-family: monospace; }
        .form-section { margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff; }
        .form-section h3 { margin-top: 0; color: #495057; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #495057; }
        .form-group .required { color: #dc3545; }
        .form-group .help-text { font-size: 12px; color: #6c757d; margin-top: 5px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-control:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 2px rgba(0,123,255,0.25); }
        .form-control.is-invalid { border-color: #dc3545; }
        .form-control.is-valid { border-color: #28a745; }
        .invalid-feedback { color: #dc3545; font-size: 12px; margin-top: 5px; }
        .valid-feedback { color: #28a745; font-size: 12px; margin-top: 5px; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 14px; transition: all 0.3s ease; margin-right: 10px; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-secondary:hover { background-color: #545b62; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-success:hover { background-color: #1e7e34; }
        .btn-warning { background-color: #ffc107; color: #212529; }
        .btn-warning:hover { background-color: #e0a800; }
        .provider-fields { display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 4px; border: 1px solid #dee2e6; }
        .provider-fields.active { display: block; }
        .provider-badge { display: inline-block; padding: 6px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; text-transform: uppercase; margin-right: 10px; }
        .badge-saml { background-color: #e1f5fe; color: #01579b; }
        .badge-oidc { background-color: #f3e5f5; color: #4a148c; }
        .badge-oauth2 { background-color: #e8f5e8; color: #1b5e20; }
        .test-result { margin-top: 20px; padding: 15px; border-radius: 4px; display: none; }
        .test-result.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .test-result.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { text-align: center; padding: 20px; color: #6c757d; }
        .checkbox-group { display: flex; align-items: center; gap: 8px; }
        .checkbox-group input[type="checkbox"] { margin: 0; }
        .attribute-mapping { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; }
        .mapping-row { display: grid; grid-template-columns: 1fr 1fr 100px; gap: 10px; margin-bottom: 10px; align-items: center; }
        .mapping-row:last-child { margin-bottom: 0; }
        .add-mapping { color: #007bff; cursor: pointer; font-size: 12px; }
        .add-mapping:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="pageTitle">â• ìƒˆ SSO ì„¤ì • ì¶”ê°€</h1>
            <div class="breadcrumb">
                <a href="/admin/auth-dashboard">Shopl B2B SaaS > ê´€ë¦¬ì > ì¸ì¦ ê´€ë¦¬</a> >
                <a href="/admin/sso/configurations">SSO ì„¤ì • ëª©ë¡</a> >
                <span id="breadcrumbAction">ìƒˆ ì„¤ì •</span>
            </div>
        </div>

        <div class="user-info">
            <p><span class="label">ê´€ë¦¬ì:</span> <span class="value" th:text="${username}">admin</span></p>
            <p><span class="label">íšŒì‚¬ ID:</span> <span class="value" th:text="${companyId}">company-001</span></p>
        </div>

        <form id="ssoConfigForm">
            <!-- ê¸°ë³¸ ì„¤ì • ì„¹ì…˜ -->
            <div class="form-section">
                <h3>ğŸ“‹ ê¸°ë³¸ ì„¤ì •</h3>

                <div class="form-group">
                    <label for="configName">ì„¤ì • ì´ë¦„ <span class="required">*</span></label>
                    <input type="text" id="configName" name="configName" class="form-control" placeholder="ì˜ˆ: Google Workspace SSO" required>
                    <div class="help-text">ì‚¬ìš©ìê°€ ì‹ë³„í•  ìˆ˜ ìˆëŠ” SSO ì„¤ì •ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="companyDomain">íšŒì‚¬ ë„ë©”ì¸ <span class="required">*</span></label>
                    <input type="text" id="companyDomain" name="companyDomain" class="form-control" placeholder="ì˜ˆ: company.com" required>
                    <div class="help-text">ì´ SSO ì„¤ì •ì„ ì‚¬ìš©í•  íšŒì‚¬ì˜ ì´ë©”ì¼ ë„ë©”ì¸ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="providerType">SSO ì œê³µì ìœ í˜• <span class="required">*</span></label>
                    <select id="providerType" name="providerType" class="form-control" required>
                        <option value="">-- ì œê³µì ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                        <option value="SAML">SAML 2.0</option>
                        <option value="OIDC">OpenID Connect (OIDC)</option>
                        <option value="OAUTH2">OAuth 2.0</option>
                    </select>
                    <div class="help-text">ì‚¬ìš©í•˜ë ¤ëŠ” SSO í”„ë¡œí† ì½œì„ ì„ íƒí•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="isEnabled" name="isEnabled" checked>
                        <label for="isEnabled">ì´ SSO ì„¤ì •ì„ í™œì„±í™”</label>
                    </div>
                    <div class="help-text">ì²´í¬ë¥¼ í•´ì œí•˜ë©´ ì´ SSO ì„¤ì •ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.</div>
                </div>
            </div>

            <!-- SAML ì„¤ì • -->
            <div id="samlFields" class="provider-fields">
                <h3><span class="provider-badge badge-saml">SAML</span> SAML 2.0 ì„¤ì •</h3>

                <div class="form-group">
                    <label for="samlMetadataUrl">ë©”íƒ€ë°ì´í„° URL <span class="required">*</span></label>
                    <input type="url" id="samlMetadataUrl" name="samlMetadataUrl" class="form-control" placeholder="https://your-idp.com/metadata">
                    <div class="help-text">SAML IdPì˜ ë©”íƒ€ë°ì´í„° XMLì„ ì œê³µí•˜ëŠ” URLì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="samlEntityId">ì—”í‹°í‹° ID</label>
                    <input type="text" id="samlEntityId" name="samlEntityId" class="form-control" placeholder="shopl-saml-sp">
                    <div class="help-text">SAML Service Provider ì—”í‹°í‹° ID (ë¹„ì›Œë‘ë©´ ìë™ ìƒì„±)</div>
                </div>

                <div class="form-group">
                    <label>ì‚¬ìš©ì ì†ì„± ë§¤í•‘</label>
                    <div class="attribute-mapping">
                        <div class="mapping-row">
                            <input type="text" placeholder="SAML ì†ì„±ëª…" class="form-control" value="email">
                            <input type="text" placeholder="ë‚´ë¶€ í•„ë“œëª…" class="form-control" value="email" readonly>
                            <button type="button" class="btn btn-sm btn-secondary">ì‚­ì œ</button>
                        </div>
                        <div class="mapping-row">
                            <input type="text" placeholder="SAML ì†ì„±ëª…" class="form-control" value="displayName">
                            <input type="text" placeholder="ë‚´ë¶€ í•„ë“œëª…" class="form-control" value="name" readonly>
                            <button type="button" class="btn btn-sm btn-secondary">ì‚­ì œ</button>
                        </div>
                        <div class="add-mapping" onclick="addAttributeMapping()">+ ì†ì„± ë§¤í•‘ ì¶”ê°€</div>
                    </div>
                </div>
            </div>

            <!-- OIDC ì„¤ì • -->
            <div id="oidcFields" class="provider-fields">
                <h3><span class="provider-badge badge-oidc">OIDC</span> OpenID Connect ì„¤ì •</h3>

                <div class="form-group">
                    <label for="oidcClientId">í´ë¼ì´ì–¸íŠ¸ ID <span class="required">*</span></label>
                    <input type="text" id="oidcClientId" name="oidcClientId" class="form-control" placeholder="your-client-id">
                    <div class="help-text">OIDC ì œê³µìì—ì„œ ë°œê¸‰ë°›ì€ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oidcClientSecret">í´ë¼ì´ì–¸íŠ¸ Secret <span class="required">*</span></label>
                    <input type="password" id="oidcClientSecret" name="oidcClientSecret" class="form-control" placeholder="your-client-secret">
                    <div class="help-text">OIDC ì œê³µìì—ì„œ ë°œê¸‰ë°›ì€ í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oidcDiscoveryUrl">Discovery URL <span class="required">*</span></label>
                    <input type="url" id="oidcDiscoveryUrl" name="oidcDiscoveryUrl" class="form-control" placeholder="https://your-provider.com/.well-known/openid_configuration">
                    <div class="help-text">OIDC ì œê³µìì˜ Well-Known êµ¬ì„± ì—”ë“œí¬ì¸íŠ¸ URLì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oidcScope">ìŠ¤ì½”í”„</label>
                    <input type="text" id="oidcScope" name="oidcScope" class="form-control" value="openid profile email" placeholder="openid profile email">
                    <div class="help-text">ìš”ì²­í•  OIDC ìŠ¤ì½”í”„ë¥¼ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”.</div>
                </div>

                <div class="form-group">
                    <label>í´ë ˆì„ ë§¤í•‘</label>
                    <div class="attribute-mapping">
                        <div class="mapping-row">
                            <input type="text" placeholder="OIDC í´ë ˆì„ëª…" class="form-control" value="email">
                            <input type="text" placeholder="ë‚´ë¶€ í•„ë“œëª…" class="form-control" value="email" readonly>
                            <button type="button" class="btn btn-sm btn-secondary">ì‚­ì œ</button>
                        </div>
                        <div class="mapping-row">
                            <input type="text" placeholder="OIDC í´ë ˆì„ëª…" class="form-control" value="name">
                            <input type="text" placeholder="ë‚´ë¶€ í•„ë“œëª…" class="form-control" value="name" readonly>
                            <button type="button" class="btn btn-sm btn-secondary">ì‚­ì œ</button>
                        </div>
                        <div class="add-mapping" onclick="addClaimMapping()">+ í´ë ˆì„ ë§¤í•‘ ì¶”ê°€</div>
                    </div>
                </div>
            </div>

            <!-- OAuth2 ì„¤ì • -->
            <div id="oauth2Fields" class="provider-fields">
                <h3><span class="provider-badge badge-oauth2">OAuth2</span> OAuth 2.0 ì„¤ì •</h3>

                <div class="form-group">
                    <label for="oauth2ClientId">í´ë¼ì´ì–¸íŠ¸ ID <span class="required">*</span></label>
                    <input type="text" id="oauth2ClientId" name="oauth2ClientId" class="form-control" placeholder="your-oauth2-client-id">
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oauth2ClientSecret">í´ë¼ì´ì–¸íŠ¸ Secret <span class="required">*</span></label>
                    <input type="password" id="oauth2ClientSecret" name="oauth2ClientSecret" class="form-control" placeholder="your-oauth2-client-secret">
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oauth2AuthUrl">ì¸ì¦ URL <span class="required">*</span></label>
                    <input type="url" id="oauth2AuthUrl" name="oauth2AuthUrl" class="form-control" placeholder="https://provider.com/oauth/authorize">
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oauth2TokenUrl">í† í° URL <span class="required">*</span></label>
                    <input type="url" id="oauth2TokenUrl" name="oauth2TokenUrl" class="form-control" placeholder="https://provider.com/oauth/token">
                    <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                    <label for="oauth2UserInfoUrl">ì‚¬ìš©ì ì •ë³´ URL</label>
                    <input type="url" id="oauth2UserInfoUrl" name="oauth2UserInfoUrl" class="form-control" placeholder="https://provider.com/userinfo">
                </div>
            </div>

            <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
            <div id="testResult" class="test-result">
                <div id="testResultMessage"></div>
            </div>

            <!-- í¼ ì•¡ì…˜ -->
            <div class="form-section">
                <h3>âš¡ ì•¡ì…˜</h3>
                <button type="button" id="testConnectionBtn" class="btn btn-warning">ğŸ”§ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <button type="submit" class="btn btn-primary">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                <a href="/admin/sso/configurations" class="btn btn-secondary">âŒ ì·¨ì†Œ</a>
            </div>
        </form>
    </div>

    <script>
        // ì œê³µì ìœ í˜•ì— ë”°ë¥¸ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        document.getElementById('providerType').addEventListener('change', function() {
            const providerType = this.value;
            const allFields = document.querySelectorAll('.provider-fields');

            // ëª¨ë“  í•„ë“œ ìˆ¨ê¸°ê¸°
            allFields.forEach(field => {
                field.classList.remove('active');
            });

            // ì„ íƒëœ ì œê³µì í•„ë“œ í‘œì‹œ
            if (providerType) {
                const targetField = document.getElementById(providerType.toLowerCase() + 'Fields');
                if (targetField) {
                    targetField.classList.add('active');
                }
            }
        });

        // ì†ì„± ë§¤í•‘ ì¶”ê°€ í•¨ìˆ˜
        function addAttributeMapping() {
            // TODO: ë™ì ìœ¼ë¡œ ë§¤í•‘ í–‰ ì¶”ê°€
            alert('ì†ì„± ë§¤í•‘ ì¶”ê°€ ê¸°ëŠ¥ì€ ê°œë°œ ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        function addClaimMapping() {
            // TODO: ë™ì ìœ¼ë¡œ í´ë ˆì„ ë§¤í•‘ í–‰ ì¶”ê°€
            alert('í´ë ˆì„ ë§¤í•‘ ì¶”ê°€ ê¸°ëŠ¥ì€ ê°œë°œ ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        // ì—°ê²° í…ŒìŠ¤íŠ¸
        document.getElementById('testConnectionBtn').addEventListener('click', async function() {
            const formData = new FormData(document.getElementById('ssoConfigForm'));
            const testResult = document.getElementById('testResult');
            const testResultMessage = document.getElementById('testResultMessage');

            this.disabled = true;
            this.textContent = 'ğŸ”„ í…ŒìŠ¤íŠ¸ ì¤‘...';

            try {
                // TODO: ì‹¤ì œ í…ŒìŠ¤íŠ¸ API í˜¸ì¶œ
                await new Promise(resolve => setTimeout(resolve, 2000)); // ì‹œë®¬ë ˆì´ì…˜

                // ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜
                testResult.className = 'test-result success';
                testResultMessage.innerHTML = 'âœ… <strong>ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!</strong><br>SSO ì œê³µìì™€ ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.';
                testResult.style.display = 'block';

            } catch (error) {
                testResult.className = 'test-result error';
                testResultMessage.innerHTML = `âŒ <strong>ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</strong><br>${error.message}`;
                testResult.style.display = 'block';
            } finally {
                this.disabled = false;
                this.textContent = 'ğŸ”§ ì—°ê²° í…ŒìŠ¤íŠ¸';
            }
        });

        // í¼ ì œì¶œ
        document.getElementById('ssoConfigForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');

            submitBtn.disabled = true;
            submitBtn.textContent = 'ğŸ’¾ ì €ì¥ ì¤‘...';

            try {
                // TODO: ì‹¤ì œ ì €ì¥ API í˜¸ì¶œ
                await new Promise(resolve => setTimeout(resolve, 1500)); // ì‹œë®¬ë ˆì´ì…˜

                alert('âœ… SSO ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                window.location.href = '/admin/sso/configurations';

            } catch (error) {
                alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ’¾ ì„¤ì • ì €ì¥';
            }
        });

        // URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬
        const urlParams = new URLSearchParams(window.location.search);
        const configId = urlParams.get('id');
        const providerType = urlParams.get('type');
        const isQuickMode = urlParams.get('quick') === 'true';

        if (configId) {
            // í¸ì§‘ ëª¨ë“œ
            document.getElementById('pageTitle').textContent = 'âœï¸ SSO ì„¤ì • í¸ì§‘';
            document.getElementById('breadcrumbAction').textContent = 'ì„¤ì • í¸ì§‘';

            // TODO: ê¸°ì¡´ ì„¤ì • ë°ì´í„° ë¡œë“œ
            console.log('í¸ì§‘ ëª¨ë“œ: ì„¤ì • ID', configId);
        } else if (isQuickMode && providerType) {
            // ë¹ ë¥¸ ì„¤ì • ëª¨ë“œ
            document.getElementById('pageTitle').textContent = `ğŸš€ ${providerType} ë¹ ë¥¸ ì„¤ì •`;
            document.getElementById('breadcrumbAction').textContent = `${providerType} ë¹ ë¥¸ ì„¤ì •`;

            // ì œê³µì íƒ€ì… ìë™ ì„ íƒ
            document.getElementById('providerType').value = providerType;
            document.getElementById('providerType').dispatchEvent(new Event('change'));

            // ë¹ ë¥¸ ì„¤ì • ë„ì›€ë§ í‘œì‹œ
            showQuickSetupHelp(providerType);

            console.log('ë¹ ë¥¸ ì„¤ì • ëª¨ë“œ:', providerType);
        }

        function showQuickSetupHelp(type) {
            let helpMessage = '';

            switch (type) {
                case 'SAML':
                    helpMessage = `ğŸš€ SAML ë¹ ë¥¸ ì„¤ì • ëª¨ë“œ

í•„ìˆ˜ ì •ë³´ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”:
â€¢ ë©”íƒ€ë°ì´í„° URL
â€¢ íšŒì‚¬ ë„ë©”ì¸ (ì˜ˆ: company.com)
â€¢ ì„¤ì • ì´ë¦„ (ì˜ˆ: "íšŒì‚¬ëª… SAML")

ë©”íƒ€ë°ì´í„° URLì€ SAML ì œê³µì(IdP)ì—ì„œ ì œê³µí•˜ëŠ” XML ë¬¸ì„œ ì£¼ì†Œì…ë‹ˆë‹¤.`;
                    break;

                case 'OIDC':
                    helpMessage = `ğŸš€ OIDC ë¹ ë¥¸ ì„¤ì • ëª¨ë“œ

í•„ìˆ˜ ì •ë³´ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”:
â€¢ í´ë¼ì´ì–¸íŠ¸ ID
â€¢ í´ë¼ì´ì–¸íŠ¸ Secret
â€¢ Discovery URL (ì¼ë°˜ì ìœ¼ë¡œ /.well-known/openid_configuration ìœ¼ë¡œ ëë‚¨)
â€¢ íšŒì‚¬ ë„ë©”ì¸ (ì˜ˆ: company.com)
â€¢ ì„¤ì • ì´ë¦„ (ì˜ˆ: "íšŒì‚¬ëª… OIDC")`;
                    break;

                case 'OAUTH2':
                    helpMessage = `ğŸš€ OAuth2 ë¹ ë¥¸ ì„¤ì • ëª¨ë“œ

í•„ìˆ˜ ì •ë³´ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”:
â€¢ í´ë¼ì´ì–¸íŠ¸ ID
â€¢ í´ë¼ì´ì–¸íŠ¸ Secret
â€¢ ì¸ì¦ URL (Authorization Endpoint)
â€¢ í† í° URL (Token Endpoint)
â€¢ ì‚¬ìš©ì ì •ë³´ URL (UserInfo Endpoint)
â€¢ íšŒì‚¬ ë„ë©”ì¸ (ì˜ˆ: company.com)
â€¢ ì„¤ì • ì´ë¦„ (ì˜ˆ: "íšŒì‚¬ëª… OAuth2")`;
                    break;
            }

            if (helpMessage) {
                alert(helpMessage);
            }
        }

        // ê¶Œí•œ í™•ì¸
        async function checkPermission() {
            try {
                const token = localStorage.getItem("access_token");
                if (!token) {
                    window.location.href = '/dashboard?error=no_token';
                    return;
                }

                const response = await fetch('/admin/sso/api/check-permission', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });

                const data = await response.json();
                if (!data.hasPermission) {
                    alert('âŒ SSO ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                    window.location.href = '/dashboard';
                }
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                window.location.href = '/dashboard?error=permission_check_failed';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¶Œí•œ í™•ì¸
        document.addEventListener('DOMContentLoaded', checkPermission);
    </script>
</body>
</html>